!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Register=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1);t.Register=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.login=new o.Login,this.isRegistered=t,this.checkLogin()}return r(e,[{key:"checkLogin",value:function(){var e=this,t=document.querySelector(".registration-submit"),n=document.querySelector(".registration-login"),r=[];fetch("http://localhost:3006/users",{headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){e.forEach(function(e){r.push(e.login)})}),t.addEventListener("click",function(t){(t.preventDefault(),n.value)?r.some(function(e){return e==n.value})?e.repeatLogin():e.checkPassword(n.value):e.renderErrorSection("Поле с логином пустое. Введите логин")})}},{key:"checkPassword",value:function(e){var t=document.querySelector(".registration-password"),n=document.querySelector(".registration-password-check");document.querySelector(".registration-login");t.value&&n.value?t.value==n.value?this.sendRegistration(e,t.value):this.failedRegistration(n):this.renderErrorSection("Поля с паролем не заполнены")}},{key:"repeatLogin",value:function(){this.renderErrorSection("Такой логин уже существует. Введите другой")}},{key:"sendRegistration",value:function(e,t){this.login.renderExitButton(),fetch("http://localhost:3006/users",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({login:e,password:t})}).then(function(e){return 201!==e.status&&console.log("Post ERROR"),e.json()}).then(function(e){console.log(e)}),this.isRegistered=!0,localStorage.setItem("login",e);var n=new Event("checkRegister");window.dispatchEvent(n)}},{key:"failedRegistration",value:function(e){this.renderErrorSection("Пароли не совпадают. Попробуйте еще")}},{key:"renderErrorSection",value:function(e){var t=document.querySelector(".error-section"),n=document.querySelector(".error-section-text");t.style="opacity: 1",n.innerHTML=e,setTimeout(function(){document.querySelector(".error-section").style="opacity: 0"},2e3)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.Login=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.checkingLogin()}return r(e,[{key:"renderExitButton",value:function(){var e=document.querySelector(".exit");e.classList.add("visible"),e.addEventListener("click",this.exitEvent)}},{key:"exitEvent",value:function(){var e=document.querySelector(".result");this.isLogged=!1,localStorage.clear(),document.querySelector(".exit").classList.remove("visible");var t=new Event("exitEvent");window.dispatchEvent(t),e.innerHTML=""}},{key:"getLogin",value:function(){var e=this,t=document.querySelector(".logpage-submit"),n=document.querySelector(".logpage-login");document.querySelector(".logpage-password");t.addEventListener("click",function(t){t.preventDefault(),n.value&&e.checkingLogin()})}},{key:"checkingLogin",value:function(){var e=this,t=document.querySelector(".logpage-submit"),n=document.querySelector(".logpage-login"),r=document.querySelector(".logpage-password"),o=[];fetch("http://localhost:3006/users",{headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){e.forEach(function(e){o.push(e)})}),t.addEventListener("click",function(t){t.preventDefault(),n.value&&r.value?o.forEach(function(t){if(t.login!==n.value||t.password!==r.value)return e.renderErrorSection("Проверьте введенные данные. Логин или пароль неверные."),!1;window.location.hash="#main",localStorage.setItem("login",n),e.renderExitButton()}):e.renderErrorSection("Поля не заполнены полностью")})}},{key:"renderErrorSection",value:function(e){var t=document.querySelector(".error-section"),n=document.querySelector(".error-section-text");t.style="opacity: 1",n.innerHTML=e,setTimeout(function(){document.querySelector(".error-section").style="opacity: 0"},2e3)}}]),e}()},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3),i=n(0),s=n(1),a=n(4);new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pages=document.querySelectorAll(".page"),window.addEventListener("exitEvent",this.renderHomePage.bind(this)),window.addEventListener("checkRegister",this.checkRegister.bind(this)),this.router=new o.Router,this.register=new i.Register,this.login=new s.Login,this.shortService=new a.ShortService,this.init(),this.login.checkingLogin(),this.regBut(),this.logBut(),this.localStorageService(),this.login.checkingLogin()}return r(e,[{key:"init",value:function(){var e=this;fetch("http://localhost:3006/links",{headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(t){e.links=t,e.initRoutes(),console.log(e.links),window.dispatchEvent(new HashChangeEvent("hashchange"))})}},{key:"initRoutes",value:function(){this.router.addRoute("",this.renderHomePage.bind(this)),this.router.addRoute("#about",this.renderAboutPage.bind(this)),this.router.addRoute("#main",this.renderMainPage.bind(this)),this.router.addRoute("#login",this.renderLoginPage.bind(this)),this.router.addRoute("404",this.renderErrorPage.bind(this))}},{key:"renderHomePage",value:function(){this.pages.forEach(function(e){console.log(e),e.classList.remove("visible")});var e=document.querySelector(".home");console.log(e),e.classList.add("visible"),window.location.hash="",document.querySelector(".exit").classList.remove("visible")}},{key:"renderAboutPage",value:function(){this.pages.forEach(function(e){console.log(e),e.classList.remove("visible")});var e=document.querySelector(".about");console.log(e),e.classList.add("visible"),window.location.hash="#about",document.querySelector(".exit").classList.remove("visible")}},{key:"renderMainPage",value:function(){localStorage.getItem("login")?(this.pages.forEach(function(e){e.classList.remove("visible")}),document.querySelector(".main").classList.add("visible"),window.location.hash="#main"):this.renderErrorPage()}},{key:"renderErrorPage",value:function(){this.pages.forEach(function(e){e.classList.remove("visible")});var e=document.querySelector(".exit"),t=document.querySelector(".error"),n=document.querySelector(".main-link");t.classList.add("visible"),window.location.hash="#error",e.classList.remove("visible"),n.addEventListener("click",this.renderHomePage.bind(this))}},{key:"renderLoginPage",value:function(){this.pages.forEach(function(e){e.classList.remove("visible")}),document.querySelector(".logpage").classList.add("visible"),window.location.hash="#login",document.querySelector(".exit").classList.remove("visible")}},{key:"regBut",value:function(){var e=this;document.querySelector(".registration").addEventListener("click",function(){e.renderAboutPage(),history.pushState({},"about","#about"),window.dispatchEvent(new HashChangeEvent("hashchange"))})}},{key:"logBut",value:function(){var e=this;document.querySelector(".login").addEventListener("click",function(){e.renderMainPage(),history.pushState({},"main","#login"),window.dispatchEvent(new HashChangeEvent("hashchange"))})}},{key:"checkRegister",value:function(){this.register.isRegistered?this.renderMainPage():console.log("Ошибка регистрации")}},{key:"localStorageService",value:function(){localStorage.getItem("login")&&this.login.renderExitButton()}}]),e}())},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.Router=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.routes={404:function(){console.log("Not found")}},this.mainContentPages=document.querySelectorAll(".page"),window.addEventListener("hashchange",function(e){t.render(decodeURI(window.location.hash))})}return r(e,[{key:"addRoute",value:function(e,t){this.routes[e]=t}},{key:"render",value:function(e){var t=e.split("/")[0];[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(this.mainContentPages)).forEach(function(e){e.classList.remove("visible")}),this.routes[t]?this.routes[t]():this.routes[404]()}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShortService=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0);t.ShortService=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.shortLinks=[],this.inp=document.querySelector(".big-link"),this.links=[],this.getLink(),this.register2=new o.Register}return r(e,[{key:"getLink",value:function(){var e=this;document.querySelector(".submit").addEventListener("click",function(t){t.preventDefault(),e.inp.value?e.sendData(e.inp.value):e.renderInputError()})}},{key:"renderInputError",value:function(){this.register2.renderErrorSection("Чтобы укоротить ссылку, ее надо сначала ввести.")}},{key:"sendData",value:function(e){var t=this;console.log(e),fetch("http://localhost:3006/links",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({source:e})}).then(function(e){return 201!==e.status&&console.log("Post ERROR"),e.json()}).then(function(e){t.shortLink(e)})}},{key:"shortLink",value:function(e){var t="pil/"+e.id;this.shortLinks.push(t),this.renderLinks(t),console.log(e)}},{key:"renderLinks",value:function(e){var t=document.querySelector(".result"),n=document.createElement("a"),r=document.createElement("span"),o=document.createElement("span"),i=document.createElement("span");console.log(this.inp.value),r.innerHTML="Короткая ссылка -  ",n.setAttribute("href",this.inp.value),n.innerHTML=e,o.innerHTML=" Оригинальная ссылка: ",i.innerHTML=this.inp.value+" <br>",t.appendChild(r),t.appendChild(n),t.appendChild(o),t.appendChild(i),this.inp.value=""}}]),e}()}]);
//# sourceMappingURL=bundle.js.map