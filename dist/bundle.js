!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Register=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(1);t.Register=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.login=new i.Login,this.isRegistered=t,this.checkLogin()}return o(e,[{key:"checkLogin",value:function(){var e=this,t=document.querySelector(".registration-submit"),n=document.querySelector(".registration-login"),o=[];fetch("http://localhost:3007/users",{headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){e.forEach(function(e){o.push(e.login)})}),t.addEventListener("click",function(t){(t.preventDefault(),n.value)?o.some(function(e){return e==n.value})?e.repeatLogin():e.checkPassword(n.value):e.renderErrorSection("Поле с логином пустое. Введите логин")})}},{key:"checkPassword",value:function(e){var t=document.querySelector(".registration-password"),n=document.querySelector(".registration-password-check");document.querySelector(".registration-login");t.value&&n.value?t.value==n.value?this.sendRegistration(e,t.value):this.failedRegistration(n):this.renderErrorSection("Поля с паролем не заполнены")}},{key:"repeatLogin",value:function(){this.renderErrorSection("Такой логин уже существует. Введите другой")}},{key:"sendRegistration",value:function(e,t){this.login.renderExitButton(),localStorage.setItem("login",e),fetch("http://localhost:3007/users",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({login:e,password:t})}).then(function(e){return 201!==e.status&&console.log("Post ERROR"),e.json()}).then(function(e){console.log(e)}),this.isRegistered=!0;var n=new Event("checkRegister");window.dispatchEvent(n)}},{key:"failedRegistration",value:function(e){this.renderErrorSection("Пароли не совпадают. Попробуйте еще")}},{key:"renderErrorSection",value:function(e){var t=document.querySelector(".error-section"),n=document.querySelector(".error-section-text");t.style="opacity: 1",n.innerHTML=e,setTimeout(function(){document.querySelector(".error-section").style="opacity: 0"},2e3)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Login=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.checkingLogin()}return o(e,[{key:"renderExitButton",value:function(){var e=document.querySelector(".exit"),t=document.querySelector(".exit-button"),n=document.querySelector(".account-button");e.classList.add("visible"),t.addEventListener("click",this.exitEvent),n.addEventListener("click",this.accountEvent)}},{key:"exitEvent",value:function(){var e=document.querySelector(".result");this.isLogged=!1,localStorage.clear(),document.querySelector(".exit").classList.remove("visible");var t=new Event("exitEvent");window.dispatchEvent(t),e.innerHTML=""}},{key:"accountEvent",value:function(){var e=new Event("accountEvent");window.dispatchEvent(e)}},{key:"getLogin",value:function(){var e=this,t=document.querySelector(".logpage-submit"),n=document.querySelector(".logpage-login");document.querySelector(".logpage-password");t.addEventListener("click",function(t){t.preventDefault(),n.value&&e.checkingLogin()})}},{key:"checkingLogin",value:function(){var e=this,t=document.querySelector(".logpage-submit"),n=document.querySelector(".logpage-login"),o=document.querySelector(".logpage-password"),i=[];fetch("http://localhost:3007/users",{headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){e.forEach(function(e){i.push(e)})}),t.addEventListener("click",function(t){t.preventDefault(),n.value&&o.value?i.forEach(function(t){if(t.login!==n.value||t.password!==o.value)return!1;window.location.hash="#main",localStorage.setItem("login",n.value),e.renderExitButton()}):e.renderErrorSection("Поля не заполнены полностью")})}},{key:"renderErrorSection",value:function(e){var t=document.querySelector(".error-section"),n=document.querySelector(".error-section-text");t.style="opacity: 1",n.innerHTML=e,setTimeout(function(){document.querySelector(".error-section").style="opacity: 0"},2e3)}}]),e}()},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(3),r=n(0),c=n(1),a=n(4);new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pages=document.querySelectorAll(".page"),window.addEventListener("exitEvent",this.renderHomePage.bind(this)),window.addEventListener("checkRegister",this.checkRegister.bind(this)),window.addEventListener("accountEvent",this.renderAccountPage.bind(this)),this.router=new i.Router,this.register=new r.Register,this.login=new c.Login,this.shortService=new a.ShortService,this.init(),this.login.checkingLogin(),this.regBut(),this.logBut(),this.localStorageService(),this.login.checkingLogin()}return o(e,[{key:"init",value:function(){var e=this;fetch("http://localhost:3007/links",{headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(t){e.links=t,e.initRoutes(),window.dispatchEvent(new HashChangeEvent("hashchange"))})}},{key:"getRepeatLogin",value:function(e){var t=localStorage.getItem("login"),n=[];e.forEach(function(e){e.login===t&&n.push(e)}),this.renderPageLogin(n),console.log(n),console.log(t)}},{key:"renderPageLogin",value:function(e){e.forEach(function(e){var t=document.createElement("span"),n=document.querySelector(".account-page");t.innerHTML="Архив ссылок пользователя "+e.login+". - "+e.link+" <br>",n.appendChild(t)})}},{key:"initRoutes",value:function(){this.router.addRoute("",this.renderHomePage.bind(this)),this.router.addRoute("#about",this.renderAboutPage.bind(this)),this.router.addRoute("#main",this.renderMainPage.bind(this)),this.router.addRoute("#login",this.renderLoginPage.bind(this)),this.router.addRoute("404",this.renderErrorPage.bind(this)),this.router.addRoute("#account",this.renderAccountPage.bind(this))}},{key:"renderHomePage",value:function(){this.pages.forEach(function(e){e.classList.remove("visible")}),document.querySelector(".home").classList.add("visible"),window.location.hash="",document.querySelector(".exit").classList.remove("visible")}},{key:"renderAboutPage",value:function(){this.pages.forEach(function(e){e.classList.remove("visible")}),document.querySelector(".about").classList.add("visible"),window.location.hash="#about",document.querySelector(".exit").classList.remove("visible")}},{key:"renderMainPage",value:function(){var e=this;localStorage.getItem("login")?(this.pages.forEach(function(t){t.classList.remove("visible"),e.getRepeatLogin(e.links)}),document.querySelector(".main").classList.add("visible"),window.location.hash="#main"):this.renderErrorPage()}},{key:"renderErrorPage",value:function(){this.pages.forEach(function(e){e.classList.remove("visible")});var e=document.querySelector(".exit"),t=document.querySelector(".error"),n=document.querySelector(".main-link");t.classList.add("visible"),window.location.hash="#error",e.classList.remove("visible"),n.addEventListener("click",this.renderHomePage.bind(this))}},{key:"renderLoginPage",value:function(){this.pages.forEach(function(e){e.classList.remove("visible")}),document.querySelector(".logpage").classList.add("visible"),window.location.hash="#login",document.querySelector(".exit").classList.remove("visible")}},{key:"renderAccountPage",value:function(){this.pages.forEach(function(e){e.classList.remove("visible")});var e=document.querySelector(".account");e.classList.toggle("visible"),window.location.hash="#account";var t=document.querySelector(".account-button");t.style="display: none",document.querySelector(".account-exit-button").addEventListener("click",function(n){window.location.hash="#main",e.classList.remove("visible"),t.style="display: block"})}},{key:"regBut",value:function(){var e=this;document.querySelector(".registration").addEventListener("click",function(){e.renderAboutPage(),history.pushState({},"about","#about"),window.dispatchEvent(new HashChangeEvent("hashchange"))})}},{key:"logBut",value:function(){var e=this;document.querySelector(".login").addEventListener("click",function(){e.renderMainPage(),history.pushState({},"main","#login"),window.dispatchEvent(new HashChangeEvent("hashchange"))})}},{key:"checkRegister",value:function(){this.register.isRegistered?this.renderMainPage():console.log("Ошибка регистрации")}},{key:"localStorageService",value:function(){localStorage.getItem("login")&&this.login.renderExitButton()}}]),e}())},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Router=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.routes={404:function(){console.log("Not found")}},this.mainContentPages=document.querySelectorAll(".page"),window.addEventListener("hashchange",function(e){t.render(decodeURI(window.location.hash))})}return o(e,[{key:"addRoute",value:function(e,t){this.routes[e]=t}},{key:"render",value:function(e){var t=e.split("/")[0];[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(this.mainContentPages)).forEach(function(e){e.classList.remove("visible")}),this.routes[t]?this.routes[t]():this.routes[404]()}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShortService=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(0);t.ShortService=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.shortLinks=[],this.inp=document.querySelector(".big-link"),this.links=[],this.getLink(),this.register2=new i.Register}return o(e,[{key:"getLink",value:function(){var e=this;document.querySelector(".submit").addEventListener("click",function(t){t.preventDefault(),e.inp.value?e.sendData(e.inp.value):e.renderInputError()})}},{key:"renderInputError",value:function(){this.register2.renderErrorSection("Чтобы укоротить ссылку, ее надо сначала ввести.")}},{key:"sendData",value:function(e){var t=this;console.log(e),fetch("https://clck.ru/--?url="+e,{method:"get"}).then(function(e){201!==e.status&&e.text().then(function(e){t.shortLink(e)})})}},{key:"shortLink",value:function(e){this.sendLink(e);var t=e;this.shortLinks.push(t),this.renderLinks(t)}},{key:"sendLink",value:function(e){fetch("http://localhost:3007/links",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({link:e,login:localStorage.getItem("login")})}).then(function(e){return 201!==e.status&&console.log("Post ERROR"),e.json()}).then(function(e){console.log(e)})}},{key:"renderLinks",value:function(e){var t=document.querySelector(".result"),n=document.createElement("a"),o=document.createElement("span"),i=document.createElement("span"),r=document.createElement("span");o.innerHTML="Короткая ссылка -  ",n.setAttribute("href",this.inp.value),n.innerHTML=e,i.innerHTML=" Оригинальная ссылка: ",r.innerHTML=this.inp.value+" <br>",t.appendChild(o),t.appendChild(n),t.appendChild(i),t.appendChild(r),this.inp.value=""}}]),e}()}]);
//# sourceMappingURL=bundle.js.map